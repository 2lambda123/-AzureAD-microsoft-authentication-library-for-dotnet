# Unit tests require .NET 3.x
steps:
- task: UseDotNet@2
  displayName: 'Use .Net Core SDK 3.x'
  inputs:
    version: 3.x

- task: UseDotNet@2
  displayName: 'Use .Net Core SDK 5.x'
  inputs:
    version: 5.x
    includePreviewVersions: true

- task: DownloadBuildArtifacts@0
  displayName: 'Download Drop'
  inputs:
    artifactName: drop
    itemPattern: '**/*'

- task: CopyFiles@2
  displayName: 'Get MSAL tests'
  inputs:
    SourceFolder: '$(build.artifactstagingdirectory)\drop\msalTests' 
    Contents: 'CacheCompat\**\*'
    TargetFolder: $(Build.SourcesDirectory)\tests\

# install python for cache tests
- task: stevedower.python.PythonScript.PythonScript@1
  displayName: 'Update PIP'
  condition: and(succeeded(), eq(variables['RunTests'], 'true'))
  inputs:
    arguments: '-m pip install --upgrade pip'

- task: stevedower.python.PythonScript.PythonScript@1
  displayName: 'Install MSAL.Python PIP'
  condition: and(succeeded(), eq(variables['RunTests'], 'true'))
  inputs:
    arguments: '-m pip install msal'

  # Run All CacheCompat Tests
- template: template-run-cachecompat-tests.yaml
  parameters:
    BuildConfiguration: '$(BuildConfiguration)'
