# template-run-unit-tests.yaml
# Run all unit tests across the LibsAndSamples.sln project

parameters:
  BuildConfiguration: 'debug'

steps:
#- task: VisualStudioTestPlatformInstaller@1
#  inputs:
#    packageFeedSelector: 'nugetOrg'
#    versionSelector: 'latestStable'

#- task: VSTest@2
#  displayName: 'Run Unit Tests - net45'
#  continueOnError: true
#  inputs:
#    testSelector: 'testAssemblies'
#    testAssemblyVer2: |
#        **\tests\Microsoft.Identity.Test.Unit.net45\bin\debug\**\Microsoft.Identity.Test.Unit.net45.dll
#        !**\obj\**
#    searchFolder: '$(System.DefaultWorkingDirectory)'
#    codeCoverageEnabled: true
#    failOnMinTestsNotRun: true
#    minimumExpectedTests: 500 # Last checked on 02/28/2020
#    otherConsoleOptions: '/platform:x64 /Framework:.NETFramework,Version=v4.6.2 /logger:console;verbosity="normal" '


- task: VSTest@2
  displayName: 'Run Unit Tests - netcore'
  continueOnError: true
  inputs:
    testSelector: 'testAssemblies'
    testAssemblyVer2: |
        **\tests\Microsoft.Identity.Test.Unit.net45\bin\debug\**\Microsoft.Identity.Test.Unit.net45.dll
        **\tests\Microsoft.Identity.Test.Unit.netcore\bin\debug\**\Microsoft.Identity.Test.Unit.netcore.dll
        !**\obj\**
    searchFolder: '$(System.DefaultWorkingDirectory)'
    codeCoverageEnabled: true
    failOnMinTestsNotRun: true
    minimumExpectedTests: 1000 # Last checked on 02/28/2020
    #otherConsoleOptions: '/platform:x64 /Framework:.NETCoreApp,Version=v2.1 /logger:console;verbosity="normal" '


- task: VSTest@2
  displayName: 'Run CacheCompat Tests'
  continueOnError: true
  inputs:
    testSelector: 'testAssemblies'
    testAssemblyVer2: |
        **\tests\CacheCompat\CommonCache.Test.Unit\bin\debug\**\CommonCache.Test.Unit.dll
        !**\obj\**
    searchFolder: '$(System.DefaultWorkingDirectory)'
    codeCoverageEnabled: true
    failOnMinTestsNotRun: true
    minimumExpectedTests: 7 # Last checked on 02/28/2020
