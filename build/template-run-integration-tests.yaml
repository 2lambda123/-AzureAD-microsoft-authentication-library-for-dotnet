# template-run-integration-tests.yaml
# Run all integration tests across the LibsAndSamples.sln project

steps:

- task: VSTest@2
  displayName: 'Run integration tests (.NET FX)'
  inputs:
    testSelector: 'testAssemblies'
    testAssemblyVer2: '**\Microsoft.Identity.Test.Integration.netfx\bin\**\net4*\Microsoft.Identity.Test.Integration.NetFx.dll'
    searchFolder: '$(System.DefaultWorkingDirectory)'
    rerunFailedTests: true
    rerunMaxAttempts: '3'
    runInParallel: false
    codeCoverageEnabled: true

- task: VSTest@2
  displayName: 'Run integration tests (.NET Core)'
  inputs:
    testSelector: 'testAssemblies'
    testAssemblyVer2: '**\Microsoft.Identity.Test.Integration.netcore\bin\**\netcore*\Microsoft.Identity.Test.Integration.NetCore.dll'
    searchFolder: '$(System.DefaultWorkingDirectory)'
    rerunFailedTests: true
    rerunMaxAttempts: '3'
    runInParallel: false
    codeCoverageEnabled: true

# Run Device Auth Tests
#This task will initiate PKey Authentication tests on a dedicated virtual machine that has been preconfigured to allow device Authentication
#using a dedicated lab account ("idlabca@msidlab8.com"). This machine is part of the "DevEx Win8 Automation" agent pool.
#Because this agent pool is shared with other teams in our org, a specific agent has been assigned to this build to avoid collisons
#and to allow teams to configure the agent as needed for their specific platform.
#This agent ('MSIDWIN802') is configured to specifically run MSAL.NET PKey Auth tests and should be used primarily.

- template: template-run-device-auth-tests.yaml
  - job: 'RunDeviceAuthTests'
    dependsOn: 'BuildAndTest'
    pool:
        name: DevEx Win8 Automation
        demands: agent.name -equals MSIDWIN802
