# CI builds should be triggered on the master branch only
trigger:
  branches:
    include:
    - 'master'

pr: none

variables:
  BuildPlatform: 'any cpu'
  BuildConfiguration: 'debug'


stages:
- stage:
  jobs:
  - job: 'BuildAndTest' 
    pool:
      vmImage: 'windows-latest'
      demands:
      - msbuild
      - visualstudio
    steps:

    - template: template-ci-and-pr.yaml

  - job: 'RunDeviceAuthTests'
    dependsOn: 'BuildAndTest'
    pool:
        name: DevEx Win8 Automation
        demands: name = 'MSIDWIN802'

    steps:

    - template: template-run-device-auth-tests.yaml
